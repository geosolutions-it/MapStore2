/**
 * Copyright 2016, GeoSolutions Sas.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree.
 */
const React = require('react');
const ReactDOM = require('react-dom');

const GeometryDetails = require('../GeometryDetails.jsx');

const expect = require('expect');

describe('GeometryDetails', () => {

    beforeEach((done) => {
        document.body.innerHTML = '<div id="container"></div>';
        setTimeout(done);
    });

    afterEach((done) => {
        ReactDOM.unmountComponentAtNode(document.getElementById("container"));
        document.body.innerHTML = '';
        setTimeout(done);
    });

    it('creates the GeometryDetails component with Circle selection', () => {
        let geometry = '{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-997961.8412912614,5364044.896940529],[-981088.5673289623,5375029.2323789345],[-964938.3010473567,5387051.374378739],[-949574.7801691033,5400063.877037861],[-935058.6374921835,5414015.385953155],[-921447.1615999483,5428850.840892769],[-908794.0707692527,5444511.693093731],[-897149.300968958,5460936.136327167],[-886558.8087854766,5478059.350819249],[-877064.3900531211,5495813.7590652285],[-868703.5149050411,5514129.292526976],[-861509.1798957251,5532933.668161492],[-855509.777778676,5552152.673689046],[-850728.9854531838,5571710.4604751505],[-847185.6705224209,5591529.842870464],[-844893.8168316323,5611532.602827285],[-843862.4692802873,5631639.798590458],[-844095.6981259931,5651772.076244408],[-845592.5829210479,5671849.982886799],[-848347.2161450273,5691794.280192834],[-852348.7265190684,5711526.257132732],[-857581.3219098409,5730968.040608193],[-864024.3516538831,5750042.902781944],[-871652.3880563355,5768675.563887461],[-880435.3267424358,5786792.489323815],[-890338.5054657331,5804322.179863145],[-901322.8409041385,5821195.453825444],[-913344.9829039423,5837345.720107049],[-926357.4855630653,5852709.240985302],[-940308.9944783591,5867225.383662222],[-955144.4494179728,5880836.8595544575],[-970805.3016189348,5893489.950385153],[-987229.7448523708,5905134.7201854475],[-1004352.9593444524,5915725.212368929],[-1022107.367590432,5925219.631101284],[-1040422.9010521804,5933580.506249364],[-1059227.2766866954,5940774.84125868],[-1078446.2822142497,5946774.24337573],[-1098004.069000354,5951555.035701222],[-1117823.4513956672,5955098.350631985],[-1137826.211352489,5957390.204322774],[-1157933.4071156615,5958421.551874119],[-1178065.6847696118,5958188.323028413],[-1198143.591412002,5956691.438233358],[-1218087.8887180383,5953936.805009378],[-1237819.8656579359,5949935.294635338],[-1257261.649133396,5944702.699244564],[-1276336.5113071473,5938259.669500522],[-1294969.1724126649,5930631.6330980705],[-1313086.097849019,5921848.69441197],[-1330615.7883883482,5911945.515688673],[-1347489.0623506473,5900961.1802502675],[-1363639.328632253,5888939.038250463],[-1379002.8495105063,5875926.535591341],[-1393518.992187426,5861975.026676047],[-1407130.4680796613,5847139.571736433],[-1419783.5589103568,5831478.719535471],[-1431428.3287106515,5815054.276302035],[-1442018.8208941328,5797931.061809953],[-1451513.2396264882,5780176.6535639735],[-1459874.1147745685,5761861.120102226],[-1467068.4497838845,5743056.74446771],[-1473067.8519009335,5723837.738940156],[-1477848.6442264258,5704279.9521540515],[-1481391.959157189,5684460.569758738],[-1483683.8128479773,5664457.809801917],[-1484715.1603993224,5644350.614038744],[-1484481.9315536164,5624218.336384794],[-1482985.0467585616,5604140.429742403],[-1480230.4135345821,5584196.132436368],[-1476228.9031605413,5564464.15549647],[-1470996.3077697686,5545022.372021009],[-1464553.2780257263,5525947.509847258],[-1456925.241623274,5507314.848741741],[-1448142.3029371738,5489197.923305387],[-1438239.1242138764,5471668.232766057],[-1427254.788775471,5454794.958803759],[-1415232.646775667,5438644.692522153],[-1402220.1441165444,5423281.1716439],[-1388268.6352012504,5408765.02896698],[-1373433.1802616369,5395153.5530747445],[-1357772.328060675,5382500.462244049],[-1341347.8848272392,5370855.6924437545],[-1324224.6703351573,5360265.200260273],[-1306470.2620891777,5350770.781527918],[-1288154.7286274293,5342409.906379838],[-1269350.3529929144,5335215.571370522],[-1250131.3474653603,5329216.169253472],[-1230573.5606792553,5324435.37692798],[-1210754.1782839424,5320892.061997217],[-1190751.4183271208,5318600.208306428],[-1170644.2225639482,5317568.860755083],[-1150511.9449099982,5317802.089600789],[-1130434.0382676073,5319298.974395844],[-1110489.7409615712,5322053.607619824],[-1090757.7640216737,5326055.117993864],[-1071315.9805462137,5331287.713384637],[-1052241.1183724622,5337730.74312868],[-1033608.4572669445,5345358.7795311315],[-1015491.5318305906,5354141.718217232],[-997961.8412912614,5364044.896940529]]]},"properties":null}';
        let type = "Circle";

        const geometryDetails = ReactDOM.render(
            <GeometryDetails
                geometry={geometry}
                type={type}/>,
            document.getElementById("container")
        );

        expect(geometryDetails).toExist();
        expect(geometryDetails.props.geometry).toExist();
        expect(geometryDetails.props.geometry).toBe(geometry);
        expect(geometryDetails.props.type).toExist(true);
        expect(geometryDetails.props.type).toBe("Circle");

        const geometryDetailsDOMNode = expect(ReactDOM.findDOMNode(geometryDetails));
        expect(geometryDetailsDOMNode).toExist();

        let childNodes = geometryDetailsDOMNode.actual.childNodes;
        expect(childNodes.length).toBe(2);
        expect(childNodes[0].className).toBe("panel-heading");
        expect(childNodes[1].className).toBe("panel-body");

        let panelBodyRows = childNodes[1].getElementsByClassName('row');
        expect(panelBodyRows).toExist();
        expect(panelBodyRows.length).toBe(2);

        expect(panelBodyRows[0].childNodes.length).toBe(4);
    });

    it('creates the GeometryDetails component with BBOX selection', () => {
        let geometry = '{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-635956.0753326667,5466776.262955805],[-635956.0753326667,4723196.8517976105],[-29351.81886150781,4723196.8517976105],[-29351.81886150781,5466776.262955805],[-635956.0753326667,5466776.262955805]]]},"properties":null}';
        let type = "BBOX";

        const geometryDetails = ReactDOM.render(
            <GeometryDetails
                geometry={geometry}
                type={type}/>,
            document.getElementById("container")
        );

        expect(geometryDetails).toExist();
        expect(geometryDetails.props.geometry).toExist();
        expect(geometryDetails.props.geometry).toBe(geometry);
        expect(geometryDetails.props.type).toExist(true);
        expect(geometryDetails.props.type).toBe("BBOX");

        const geometryDetailsDOMNode = expect(ReactDOM.findDOMNode(geometryDetails));
        expect(geometryDetailsDOMNode).toExist();

        let childNodes = geometryDetailsDOMNode.actual.childNodes;
        expect(childNodes.length).toBe(2);
        expect(childNodes[0].className).toBe("panel-heading");
        expect(childNodes[1].className).toBe("panel-body");

        let panelBodyRows = childNodes[1].getElementsByClassName('row');
        expect(panelBodyRows).toExist();
        expect(panelBodyRows.length).toBe(5);
    });
});
