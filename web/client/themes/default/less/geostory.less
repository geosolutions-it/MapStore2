@ms-story-bg: @ms2-color-background;
@ms-story-bg-grey: @ms2-color-shade-lighter;
@ms-story-highlight: lighten(@ms2-color-primary, 20%);

@ms-story-font-size-base: 21px;
@ms-story-font-size-large: ceil(@ms-story-font-size-base * 1.5);
@ms-story-font-size-small: ceil(@ms-story-font-size-base* 0.75);
@ms-story-font-size-h1: floor((@ms-story-font-size-base * 2.0));
@ms-story-font-size-h2: floor((@ms-story-font-size-base * 1.8));
@ms-story-font-size-h3: floor((@ms-story-font-size-base * 1.6));
@ms-story-font-size-h4: floor((@ms-story-font-size-base * 1.4));
@ms-story-font-size-h5: @ms-story-font-size-base;
@ms-story-font-size-h6: floor((@ms-story-font-size-base * 0.85));


/* TEXT EDITOR TODO: externalize */
@import '~draft-js-inline-toolbar-plugin/lib/plugin.css';
@import '~react-draft-wysiwyg/dist/react-draft-wysiwyg.css';

/* mixin for position sticky */
.ms-position-sticky {
    position: -webkit-sticky;
    position: -moz-sticky;
    position: -ms-sticky;
    position: -o-sticky;
    position: sticky;
}

#page-geostory{
    position: absolute;
    #home-button {
        float: right;
    }
    #mapstore-navbar-container {
        margin-bottom: 0;
        z-index: 100;
    }
}

.ms-geostory-builder {

    /* used to calculate correctly width of children */
    > .ms2-border-layout-body > .ms2-border-layout-content {
        position: relative;
        width: 100%;
    }

    .ms-geostory-builder-header {
        padding: 8px 0;
    }

    /*
    overrides for side grid*/
    .msSideGrid {
        position: relative;
        /*
        we should not use bootstrap components inside our custom component
        in particular Row and Col because their behaviours rely on the screen page width
        */
        .row {
            margin: 0;
        }
        .col-xs-12 {
            padding: 0;
        }
    }

    .ms-section-preview {
        position: relative;
        /*
        Simple style for icon preview in builder */
        .ms-section-preview-icon {
            position: absolute;
            display: flex;
            width: 100%;
            height: 100%;
            background-color: @ms-story-bg-grey;
            & > * {
                margin: auto; /* center first child in preview */
                align-self: center; /* center first child in preview (ie) */
            }
        }
    }
}

.ms-cascade-story {

    /////////////
    // SECTIONS
    /////////////

    .ms-sections {
        /*
        Main scrollable container of the cascade story
        */
        .ms-sections-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }
    }

    ////////////
    // SECTION
    ////////////

    .ms-section {
        position: relative;
        z-index: 1;
        background-color: @ms-story-bg;
        /*
        This class combines position sticky with height 0 and overflow-y visible
        to provide a fixed background inside the section.
        In case position sticky is not supported part of the style will be manage by js using position: fixed
        to provide a similar effect
        */
        .ms-section-background {
            .ms-position-sticky();
            top: 0;
            width: 100%;
            height: 0;
            overflow-y: visible;
            .ms-section-background-container {
                z-index: 0;
                width: 100%;
                overflow: hidden;
                position: relative;
                pointer-events: auto;
                background-color: @ms-story-bg-grey;
            }
        }
        /*
        Container for all the contents inside a section
        */
        .ms-section-contents {
            pointer-events: none;
            .add-bar, .popover-content {
                pointer-events: auto;
            }
            position: relative;
            z-index: 1;
            height: 100%;
        }

        .add-bar {
            position: relative;
            width: 100%;
            background-color: @ms-story-bg;
            border-bottom: 1px solid @ms-story-bg-grey;
            text-align: center;
            .btn {
                /* override default style of bootstrap */
                .square-button-md();
                .no-border();
                background: transparent;

                /*
                this button needs a outline when focus to highlight
                outline is vibile also when using tab key*/
                &:focus,
                &:active:focus,
                &.active:focus,
                &.focus,
                &:active.focus,
                &.active.focus {
                    outline: auto !important; /* outline it desable globally with !important */
                }
            }
        }

        &.ms-section-title {
            .ms-content-text {
                display: flex;
            }
            .ms-content-body {
                display: flex;
                margin: auto;
                align-self: center;
                padding: 32px;
            }
        }

        &.ms-section-paragraph {
            padding: 0 15%;
            background-color: @ms-story-bg;
            /*
            overrides for themes of text content
            - remove shadow */
            .ms-content.ms-content-text.ms-bright .ms-content-body > *,
            .ms-content.ms-content-text.ms-dark .ms-content-body > * {
                box-shadow: none;
            }
        }

        &.ms-section-immersive { /**/ }
    }

    ////////////
    // CONTENT
    ////////////

    .ms-content {
        position: relative;
        /*
        pointer-events are disable from `.ms-section-contents` class
        we need to restore the possibility to interact with the content body
        using `pointer-events: auto;`
        */
        .ms-content-body > * {
            pointer-events: auto;
        }
        /* this styles applies to all content text of a cascade story */
        &.ms-content-text {
            .ms-content-body {
                word-break: break-word; /* we need to break text without space to avoid horizontal scrollbar */

                /* font size for all the main classes in text content */
                p { font-size: @ms-story-font-size-base; }
                h1 { font-size: @ms-story-font-size-h1; }
                h2 { font-size: @ms-story-font-size-h2; }
                h3 { font-size: @ms-story-font-size-h3; }
                h4 { font-size: @ms-story-font-size-h4; }
                h5 { font-size: @ms-story-font-size-h5; }
                h6 { font-size: @ms-story-font-size-h6; }

                .ms-text-editor-wrapper {
                    display: flex;
                    flex-direction: column;
                }

                /*
                with position sticky the toolbar is visible in the view
                also when texteditor has height greater than view height*/
                .ms-text-editor-toolbar {
                    font-size: 12px;
                    .ms-position-sticky();
                    top: 8px;
                    z-index: 2;
                    border: none;
                    border-radius: 0;
                    color: contrast(@ms-story-bg);
                    background-color: @ms-story-bg;
                    .shadow-soft();
                    /*
                    highlight when button is active
                    base style is not visible */
                    .rdw-option-active {
                        outline: 2px solid @ms-story-highlight;
                    }
                    /* enbale horizontal scrollbar only if needed of color picker*/
                    .rdw-colorpicker-modal-options {
                        overflow-x: auto;
                    }
                    /* enbale vertical scrollbar only if needed of font family and tag dropdown */
                    .rdw-dropdown-optionwrapper {
                        overflow-y: auto;
                    }
                    /* reduced font side to avoid new lines */
                    .rdw-colorpicker-modal-style-label {
                        font-size: 12px;
                    }
                    /* changed border color of color picker tab*/
                    .rdw-colorpicker-modal-style-label-active {
                        border-bottom-color: @ms-story-highlight;
                    }
                }

                /*
                some overrides to render the text editor similar to read only text*/
                .ms-text-editor-main {
                    position: relative;
                    flex: 1;
                    height: auto;
                    /*
                    text area has different structure from plain html text
                    so we need to apply right font size to children of headers and paragraph tags
                    because span inherits the wrong font size*/
                    p span, div span { font-size: @ms-story-font-size-base; }
                    h1 span { font-size: @ms-story-font-size-h1; }
                    h2 span { font-size: @ms-story-font-size-h2; }
                    h3 span { font-size: @ms-story-font-size-h3; }
                    h4 span { font-size: @ms-story-font-size-h4; }
                    h5 span { font-size: @ms-story-font-size-h5; }
                    h6 span { font-size: @ms-story-font-size-h6; }

                    /*
                    headers and paragraph tags have a div children with `margin: 1em 0;`
                    this style increases the size of the text container and it's different from the plain html
                    setting margin to 0 we get a similar visualization to plain html */
                    h1 > div,
                    h2 > div,
                    h3 > div,
                    h4 > div,
                    h5 > div,
                    h6 > div,
                    p > div { margin: 0; }
                }

                /* padding for the first child of content body of text content */
                & > * {
                    padding: 16px;
                }
            }

            /* themes of text contents */
            &.ms-bright .ms-content-body > * {
                color: contrast(@ms-story-bg);
                background-color: fade(@ms-story-bg, 75%);
                .shadow-far();
            }
            &.ms-bright-transparent .ms-content-body > * {
                color: contrast(@ms-story-bg);
                background-color: transparent;
            }
            &.ms-dark .ms-content-body > * {
                color: @ms-story-bg;
                background-color: fade(contrast(@ms-story-bg), 75%);
                .shadow-far();
            }
            &.ms-dark-transparent .ms-content-body > * {
                color: @ms-story-bg;
                background-color: transparent;
            }
        }

        /* size of content */
        &.ms-size-full { width: 100%; }
        &.ms-size-large { width: 85%; }
        &.ms-size-medium { width: 60%; }
        &.ms-size-small { width: 40%; }

        /* alignement of content */
        &.ms-align-center { margin-left: auto; margin-right: auto; }
        &.ms-align-left { margin-left: 0; margin-right: auto; }
        &.ms-align-right { margin-left: auto; margin-right: 0; }
    }

    //////////
    // MEDIA
    //////////

    .ms-media {
        &.ms-media-image {
            position: relative;
            width: 100%;
            height: 100%;
            & > img {
                position: relative;
                width: 100%;
                height: 100%;
            }
        }
    }

    /////////////////////
    // LIBRARIES FIX
    /////////////////////

    // issue in react-draft-wysiwyg align not working on multiline paragraph
    .public-DraftStyleDefault-ltr {
        text-align: inherit;
    }
}
